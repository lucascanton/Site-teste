import React, { useState, useEffect } from 'react';
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, AreaChart, Area } from 'recharts';
import { TrendingDown, Calendar, DollarSign, Zap } from 'lucide-react';

const App = () => {
  const [extraAmortization, setExtraAmortization] = useState(750);
  const [initialBalance] = useState(15000); // Valor estimado baseado na parcela de 518
  const [interestRate] = useState(0.019); // Estimativa de 1.9% a.m.
  const [monthlyPayment] = useState(518.20);

  const calculateData = (extra) => {
    let balance = initialBalance;
    let data = [{ month: 0, balance: initialBalance, interestSaved: 0 }];
    let totalInterestPaid = 0;
    let month = 0;

    while (balance > 0 && month < 60) {
      month++;
      const interest = balance * interestRate;
      const principalFromPayment = monthlyPayment - interest;
      
      // Amortização total = principal da parcela + extra
      const totalAmortization = principalFromPayment + extra;
      
      balance = Math.max(0, balance - totalAmortization);
      totalInterestPaid += interest;

      data.push({
        month,
        balance: Math.round(balance),
        extra: extra
      });
    }
    return data;
  };

  const data500 = calculateData(500);
  const data1000 = calculateData(1000);
  const dataNormal = calculateData(0);

  const months500 = data500.length - 1;
  const months1000 = data1000.length - 1;
  const monthsNormal = dataNormal.length - 1;

  return (
    <div className="min-h-screen bg-slate-50 p-4 md:p-8 font-sans">
      <div className="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
        <div className="bg-indigo-600 p-6 text-white">
          <h1 className="text-2xl font-bold flex items-center gap-2">
            <Zap className="fill-current" /> Simulador de Amortização (CC - Barbacena)
          </h1>
          <p className="opacity-90">Comparando o impacto de R$ 500 a R$ 1.000 extras por mês.</p>
        </div>

        <div className="p-6">
          <div className="mb-8 bg-indigo-50 p-4 rounded-xl border border-indigo-100">
            <label className="block text-sm font-semibold text-indigo-900 mb-2">
              Ajuste o valor extra para simulação rápida: R$ {extraAmortization}
            </label>
            <input 
              type="range" 
              min="500" 
              max="1000" 
              step="50"
              value={extraAmortization}
              onChange={(e) => setExtraAmortization(parseInt(e.target.value))}
              className="w-full h-2 bg-indigo-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"
            />
          </div>

          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8 text-center">
            <div className="p-4 bg-slate-100 rounded-lg border border-slate-200">
              <span className="text-xs uppercase font-bold text-slate-500">Sem Extra</span>
              <div className="text-2xl font-bold text-slate-700">{monthsNormal} meses</div>
            </div>
            <div className="p-4 bg-blue-100 rounded-lg border border-blue-200">
              <span className="text-xs uppercase font-bold text-blue-600">Com R$ 500 extra</span>
              <div className="text-2xl font-bold text-blue-700">{months500} meses</div>
            </div>
            <div className="p-4 bg-emerald-100 rounded-lg border border-emerald-200">
              <span className="text-xs uppercase font-bold text-emerald-600">Com R$ 1000 extra</span>
              <div className="text-2xl font-bold text-emerald-700">{months1000} meses</div>
            </div>
          </div>

          <div className="h-64 md:h-80 w-full mb-6">
            <ResponsiveContainer width="100%" height="100%">
              <AreaChart data={dataNormal}>
                <defs>
                  <linearGradient id="colorNormal" x1="0" y1="0" x2="0" y2="1">
                    <stop offset="5%" stopColor="#94a3b8" stopOpacity={0.1}/>
                    <stop offset="95%" stopColor="#94a3b8" stopOpacity={0}/>
                  </linearGradient>
                </defs>
                <CartesianGrid strokeDasharray="3 3" vertical={false} />
                <XAxis dataKey="month" label={{ value: 'Meses', position: 'insideBottomRight', offset: -5 }} />
                <YAxis label={{ value: 'Saldo (R$)', angle: -90, position: 'insideLeft' }} />
                <Tooltip formatter={(value) => `R$ ${value}`} labelFormatter={(m) => `Mês ${m}`} />
                <Legend />
                <Area type="monotone" dataKey="balance" stroke="#94a3b8" name="Plano Original" fillOpacity={1} fill="url(#colorNormal)" strokeWidth={2} />
                <Area type="monotone" data={data500} dataKey="balance" stroke="#3b82f6" name="Extra R$ 500" fill="transparent" strokeWidth={3} />
                <Area type="monotone" data={data1000} dataKey="balance" stroke="#10b981" name="Extra R$ 1000" fill="transparent" strokeWidth={4} />
              </AreaChart>
            </ResponsiveContainer>
          </div>

          <div className="bg-amber-50 border-l-4 border-amber-400 p-4 rounded-r-lg">
            <div className="flex items-start gap-3">
              <TrendingDown className="text-amber-600 mt-1" />
              <div>
                <h3 className="font-bold text-amber-900">Análise de Coerência</h3>
                <p className="text-sm text-amber-800 leading-relaxed">
                  Amortizando **R$ 500**, você já reduz o tempo da dívida em mais de 50%. <br/>
                  Amortizando **R$ 1.000**, você entra no modo "turbo": a dívida é liquidada em cerca de 1/4 do tempo original. 
                  Como você estuda computação, pense nisso como reduzir a complexidade temporal de O(n) para algo muito próximo de O(1) em termos de impacto na sua vida.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
      <p className="text-center text-slate-400 text-xs mt-6">Simulação baseada em juros compostos médios de mercado para este valor de parcela.</p>
    </div>
  );
};

export default App;
